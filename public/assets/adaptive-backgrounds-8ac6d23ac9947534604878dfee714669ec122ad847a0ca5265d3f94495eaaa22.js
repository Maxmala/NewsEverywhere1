!function(d){function e(r,e){var t=r.split(","),a=e<0?0:255,n=e<0?-1*e:e,o=parseInt(t[0].slice(4)),s=parseInt(t[1]),c=parseInt(t[2]);return"rgb("+(Math.round((a-o)*n)+o)+","+(Math.round((a-s)*n)+s)+","+(Math.round((a-c)*n)+c)+")"}function t(r,e,t){var a=r.split(","),n=e.split(","),o=parseInt(a[0].slice(4)),s=parseInt(a[1]),c=parseInt(a[2]);return"rgb("+(Math.round((parseInt(n[0].slice(4))-o)*t)+o)+","+(Math.round((parseInt(n[1])-s)*t)+s)+","+(Math.round((parseInt(n[2])-c)*t)+c)+")"}var n="data-ab-color",g="data-ab-parent",o="data-ab-css-background",h="ab-color-found",p="blend",a={selector:"[data-adaptive-background]",parent:null,exclude:["rgb(0,0,0)","rgb(255,255,255)"],shadeVariation:!1,shadePercentage:0,shadeColors:{light:"rgb(255,255,255)",dark:"rgb(0,0,0)"},normalizeTextColor:!1,normalizedTextColors:{light:"#fff",dark:"#000"},lumaClasses:{light:"ab-light",dark:"ab-dark"},transparent:null};!function(r,u){"use strict";var n=function(r,e){var t=document.createElement("canvas");return t.setAttribute("width",r),t.setAttribute("height",e),t.getContext("2d")},e=function(r,t){var a=new Image,e=r.src||r;"data:"!==e.substring(0,5)&&(a.crossOrigin="Anonymous"),a.onload=function(){var r=n(a.width,a.height);r.drawImage(a,0,0);var e=r.getImageData(0,0,a.width,a.height);t&&t(e.data)},a.src=e},l=function(r){return["rgb(",r,")"].join("")},d=function(r){var e=[];for(var t in r)e.push(a(t,r[t]));return e.sort(function(r,e){return e.count-r.count}),e},g=function(r,e){if(r.length>e)return r.slice(0,e);for(var t=r.length-1;t<e-1;t++)r.push(a("0,0,0",0));return r},a=function(r,e){return{name:l(r),count:e}},t=10,o={colors:function(r,s){var c=(s=s||{}).exclude||[],i=s.paletteSize||t;e(r,function(r){for(var e={},t="",a=[],n=0;n<r.length;n+=4)a[0]=r[n],a[1]=r[n+1],a[2]=r[n+2],t=a.join(","),-1===a.indexOf(u)&&0!==r[n+3]&&-1===c.indexOf(l(t))&&(e[t]=t in e?e[t]+1:1);if(s.success){var o=g(d(e),i+1);s.success({dominant:o[0].name,secondary:o[1].name,palette:o.map(function(r){return r.name}).slice(1)})}})}};r.RGBaster=r.RGBaster||o}(window),d.adaptiveBackground={run:function(r){var l=d.extend({},a,r);d(l.selector).each(function(){var s=d(this),r=function(){if("PICTURE"==s[0].tagName){var r=s[0].children;for(var e in r)if("IMG"==r[e].tagName){var t=r[e];break}t.currentSrc&&(t=t.currentSrc)}else t=i()?a():s[0];RGBaster.colors(t,{paletteSize:20,exclude:l.exclude,success:function(r){s.attr(n,r.dominant),s.trigger(h,{color:r.dominant,palette:r.palette})}})},c=function(r){var e=r.match(/\d+/g);return(299*e[0]+587*e[1]+114*e[2])/1e3},i=function(){var r=s.attr(o);return typeof r!=typeof undefined&&!1!==r},a=function(){var r=s.css("background-image");return/\(([^)]+)\)/.exec(r)[1].replace(/"/g,"")},u=function(r){return 1==l.shadeVariation?c(r)<=128?e(r,l.shadePercentage):e(r,-l.shadePercentage,l.shadePercentage):l.shadeVariation==p?128<=c(r)?t(r,l.shadeColors.dark,l.shadePercentage):t(r,l.shadeColors.light,l.shadePercentage):void 0};s.on(h,function(r,e){var t;if(t=l.parent&&s.parents(l.parent).length?s.parents(l.parent):s.attr(g)&&s.parents(s.attr(g)).length?s.parents(s.attr(g)):i()?s:l.parent?s.parents(l.parent):s.parent(),l.shadeVariation&&(e.color=u(e.color)),d.isNumeric(l.transparent)&&null!=l.transparent&&.01<=l.transparent&&l.transparent<=.99){var a=e.color.replace("rgb","rgba").replace(")",", "+l.transparent+")");t.css({backgroundColor:a})}else t.css({backgroundColor:e.color});var n=function(r){return 128<=c(r)?l.normalizedTextColors.dark:l.normalizedTextColors.light},o=function(r){return c(r)<=128?l.lumaClasses.dark:l.lumaClasses.light};l.normalizeTextColor&&t.css({color:n(e.color)}),t.addClass(o(e.color)).attr("data-ab-yaq",c(e.color)),l.success&&l.success(s,e)}),r()})}}}(jQuery);